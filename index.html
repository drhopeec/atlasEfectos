<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atlas de Efectos Psicod√©licos</title>
  
  <link rel="stylesheet" href="estilos.css">
  
  <script src="efectos.js"></script>
  <script src="referencias.js"></script>
</head>
<body>

  <main id="atlas-container"></main>


  <script>
    
    // --- SECCI√ìN 1: DATOS Y TEXTOS NARRATIVOS ---

    const ordenDominios = ["visual", "cognitivo", "emocional", "existencial", "somatico"];

    const textoIntroduccion = `
      <p>Este atlas es una herramienta cl√≠nica dise√±ada para acompa√±arte antes, durante y despu√©s de cada sesi√≥n asistida con psilocibina. No es un texto te√≥rico ni una gu√≠a espiritual: es un instrumento operativo que traduce la complejidad de la experiencia en lenguaje cl√≠nico.</p>
      <p>Su prop√≥sito es reducir la incertidumbre, aumentar la seguridad y ofrecer marcos claros de interpretaci√≥n. Cada p√°gina busca ayudarte a identificar fen√≥menos, decidir cu√°ndo intervenir, y reconocer cu√°ndo basta con sostener.</p>
      <p>Este documento no reemplaza tu criterio cl√≠nico: lo organiza. Te ofrece un mapa estructurado para navegar lo desconocido con rigor, claridad y √©tica.</p>
    `;
    
    const textoCu√°ndoUsar = `
      <p>Este atlas no es para leerlo una vez. Es una herramienta activa que acompa√±a tu pr√°ctica antes, durante y despu√©s de cada sesi√≥n.</p>
      <ul>
        <li><strong>En la preparaci√≥n:</strong> √ösalo para psicoeducar al paciente, establecer expectativas realistas y anticipar riesgos seg√∫n su perfil cl√≠nico.</li>
        <li><strong>Durante la sesi√≥n:</strong> √ösalo para interpretar lo que observas, elegir si intervenir o sostener, y evitar confundir un proceso profundo con una crisis cl√≠nica.</li>
        <li><strong>En la integraci√≥n:</strong> √ösalo para traducir lo vivido en lenguaje comprensible, anclar los insights y guiar pr√°cticas que consoliden el cambio.</li>
      </ul>
      <p class="highlight">Este no es un documento de lectura pasiva. Es un mapa cl√≠nico para navegar lo desconocido.</p>
    `;

    const textoQu√©Hacer = `
      <p>No todo fen√≥meno cabe en una casilla. Si lo que observas no est√° descrito, no significa que est√©s en peligro. Significa que est√°s frente a lo vivo.</p>
      <p>En esos casos:</p>
      <ol>
        <li><strong>Sost√©n antes de intervenir.</strong> Si no hay signos de riesgo, tu presencia es suficiente.</li>
        <li><strong>Anota con detalle.</strong> Qu√© dijo. Qu√© viste. Qu√© cambi√≥ en su cuerpo. Esa informaci√≥n es valiosa para ti y para el campo.</li>
        <li><strong>Consulta si hay duda.</strong> Usa esta observaci√≥n para profundizar en supervisi√≥n o mentor√≠a.</li>
      </ol>
      <p class="highlight">Recuerda: Lo desconocido no siempre es patol√≥gico. A veces es solo in√©dito.</p>
    `;
    
    const textoC√≥moUsar = `
      <p>Este recurso est√° dise√±ado para el cl√≠nico. Pero puedes usarlo con el paciente, si lo haces con cuidado.</p>
      <p>Evita dar nombres que sugieran diagn√≥stico o espiritualidad cerrada. En su lugar, nombra procesos con lenguaje neutral, como ‚ÄúEsto suele pasar cuando el cerebro se reorganiza‚Äù o ‚ÄúA veces la mente necesita descomponerse para ver algo nuevo‚Äù.</p>
      <p>Recuerda que los psicod√©licos aumentan la sugestionabilidad. Lo que digas se puede convertir en verdad interna. Usa este poder con √©tica. Y si no sabes qu√© est√° pasando, dilo. Eso tambi√©n es sostener.</p>
    `;

    const textosDominio = {
      "visual": "Lo que el paciente <strong>ve</strong>. Desde patrones geom√©tricos hasta la 'respiraci√≥n' de las paredes. Aqu√≠ se aprende a no sobre-intervenir, solo a validar la experiencia.",
      "cognitivo": "Lo que el paciente <strong>piensa</strong>. Bucles, 'insights' acelerados y la distorsi√≥n del tiempo. El reto es guiar el proceso sin interrumpir el flujo del pensamiento.",
      "emocional": "Lo que el paciente <strong>siente</strong>. La emergencia de miedo, culpa, ansiedad o euforia. Este es el n√∫cleo del trabajo terap√©utico y el terreno de la intervenci√≥n activa.",
      "existencial": "Lo que el paciente <strong>es</strong> (o deja de ser). La disoluci√≥n del yo y la unidad m√≠stica. El terreno m√°s profundo, transformador y potencialmente desorientador.",
      "somatico": "Lo que el paciente <strong>libera</strong>. Temblores, opresi√≥n tor√°cica y catarsis f√≠sica. La intervenci√≥n aqu√≠ se centra en la seguridad y la permisi√≥n de la memoria corporal."
    };
    
    const glosarioData = [
      {
        "termino": "Moduladores de riesgo",
        "definicion": "Variables que modifican la respuesta (dosis, set, setting, historia cl√≠nica, medicaci√≥n)."
      },
      {
        "termino": "Banderas rojas",
        "definicion": "Indicadores que sugieren posible complicaci√≥n m√©dica o psiqui√°trica."
      },
      {
        "termino": "Frase de normalizaci√≥n",
        "definicion": "Enunciado verbal breve que ayuda al paciente a integrar y aceptar el fen√≥meno sin p√°nico."
      },
      {
        "termino": "Manual de intervenci√≥n",
        "definicion": "Protocolo de tres niveles (sost√©n, anclaje, reencuadre) y un nivel de emergencia (escalamiento)."
      },
      {
        "termino": "REBUS (Relaxed Beliefs Under Psychedelics)",
        "definicion": "Modelo neurobiol√≥gico que postula que los psicod√©licos 'relajan' las creencias o predicciones (priores) de alto nivel del cerebro, permitiendo un mayor flujo de informaci√≥n."
      },
      {
        "termino": "DMN (Red de Modo por Defecto)",
        "definicion": "Red cerebral asociada con el pensamiento autorreferencial (el 'yo' narrativo). Su desactivaci√≥n se correlaciona con la disoluci√≥n del ego."
      }
    ];


    // --- SECCI√ìN 2: FUNCIONES DE AYUDA PARA RENDERIZAR ---

    function mapearLista(items) {
      if (!items || items.length === 0) return '<p>NA</p>';
      return `<ul>${items.map(item => `<li>${item}</li>`).join('')}</ul>`;
    }

    function generarHtmlReferencias(dominios = []) {
      if (typeof referenciasData === 'undefined') return ''; 
      const referenciasUnicas = new Set();
      
      for (const dominio of dominios) {
        if (referenciasData[dominio]) {
          referenciasData[dominio].forEach(ref => {
            referenciasUnicas.add(JSON.stringify(ref));
          });
        }
      }
      const referencias = Array.from(referenciasUnicas).map(refStr => JSON.parse(refStr));
      if (referencias.length === 0) return ''; 

      const listaHtml = referencias.map(ref => `
        <li>
          <strong>${ref.referencia}</strong>
          ${ref.resumen_atlas}
        </li>
      `).join('');

      return `
        <div class="pagina-a4 referencias-pagina">
          <h1 style="text-transform: capitalize;">Referencias Cl√≠nicas: Dominio ${dominios[0]}</h1>
          <ul class="lista-referencias">
            ${listaHtml}
          </ul>
        </div>
      `;
    }

    function generarHtmlFicha(efecto) {
      return `
        <div class="pagina-a4 ficha-a4">
          <header class="ficha-header">
            <h1>${efecto.efecto}</h1>
            <h2>${efecto.dominio.join(' / ')}</h2>
          </header>
          
          <div class="ficha-grid">
            
            <div class="grid-col">
              <h3>Fenomenolog√≠a</h3>
              <h4>Lo que el Paciente Reporta</h4>
              <p>${efecto.fenomenologia.descripcion_paciente}</p>
              <h4>Signos Observables (Para ti)</h4>
              <p>${efecto.fenomenologia.signos_observables}</p>
            </div>
            
            <div class="grid-col">
              <h3>Neurobiolog√≠a Aplicada</h3>
              <h4>Mecanismo Hipot√©tico</h4>
              <p>${efecto.neurobiologia_aplicada.mecanismo_hipotetico}</p>
              <h4>Frase de Normalizaci√≥n (Tu Herramienta)</h4>
              <p><em>"${efecto.neurobiologia_aplicada.frase_de_normalizacion}"</em></p>
            </div>
            
            <div class="grid-col">
              <h3>Riesgo e Intervenci√≥n</h3>
              <div class="matriz-riesgo-box">
                <h4 class="riesgo-titulo">Matriz de Riesgo: <span>${efecto.matriz_riesgo.split(' ')[0]}</span></h4>
                <p>${efecto.matriz_riesgo.split(' (Justificaci√≥n: ')[1].slice(0, -1)}</p>
              </div>
              <h4>Moduladores de Riesgo</h4>
              ${mapearLista([
                `<strong>Dosis:</strong> ${efecto.moduladores_riesgo.dosis}`,
                `<strong>Historial:</strong> ${efecto.moduladores_riesgo.historial.join(', ')}`,
                `<strong>Set & Setting:</strong> ${efecto.moduladores_riesgo.set_setting.join(', ')}`
              ])}
              <h4>Banderas Rojas (Diag. Diferencial)</h4>
              ${mapearLista(efecto.banderas_rojas_diagnostico_diferencial)}
            </div>
            
            <div class="ficha-manual">
              <h3>Manual de Intervenci√≥n</h3>
              <div class="bloque-icono">
                <div class="icono">üïäÔ∏è</div>
                <div>
                  <h4>Sost√©n (No Intervenci√≥n)</h4>
                  <p class="micro-etiqueta">Frase(s) Modelo:</p>
                  <p>${efecto.manual_de_intervencion.no_intervencion_sosten}</p>
                </div>
              </div>
              <div class="bloque-icono">
                <div class="icono">‚öì</div>
                <div>
                  <h4>Anclaje (Intervenci√≥n M√≠nima)</h4>
                  <p class="micro-etiqueta">Acci√≥n / Frase(s) Modelo:</p>
                  <p>${efecto.manual_de_intervencion.intervencion_minima_anclaje}</p>
                </div>
              </div>
              <div class="bloque-icono">
                <div class="icono">üîÅ</div>
                <div>
                  <h4>Re-encuadre (Intervenci√≥n Activa)</h4>
                  <p class="micro-etiqueta">Frase(s) Modelo:</p>
                  <p>${efecto.manual_de_intervencion.intervencion_activa_reencuadre}</p>

                </div>
              </div>
              <div class="bloque-icono">
                <div class="icono">üö®</div>
                <div>
                  <h4>Escalamiento</h4>
                  <p>${efecto.criterios_de_escalamiento.criterio_observable_para_escalar} <strong>Acci√≥n:</strong> ${efecto.criterios_de_escalamiento.accion_de_escalamiento}</p>
                </div>
              </div>
            </div>

            <div class="ficha-integracion">
              <h3>Integraci√≥n Post-Sesi√≥n</h3>
              <h4>Tema a Explorar</h4>
              <p>${efecto.integracion_post_sesion.tema_a_explorar}</p>
              <h4>Pr√°ctica Sugerida</h4>
              <p>${efecto.integracion_post_sesion.practica_sugerida}</p>
            </div>
            
          </div>
        </div>
      `;
    }
    
    function generarSeccion(texto, titulo) {
      return `
        <div class="pagina-a4 section-a4">
          <h1>${titulo}</h1>
          ${texto}
        </div>
      `;
    }
    
    function generarGlosario() {
      const itemsHtml = glosarioData.map(item => `
        <div class="glossary-item">
          <strong>${item.termino}</strong>
          ${item.definicion}
        </div>
      `).join('');
      
      return `
        <div class="pagina-a4 glossary-a4">
          <h1>Glosario de T√©rminos Cl√≠nicos</h1>
          ${itemsHtml}
        </div>
      `;
    }
    
    function generarChecklist() {
      return `
        <div class="pagina-a4 section-a4">
          <h1>Ap√©ndice: Hoja de Uso Cl√≠nico</h1>
          <h3>Checklist de Preparaci√≥n de Sesi√≥n (Pre-vuelo)</h3>
          <ul>
            <li>Confirmaci√≥n de criterios de exclusi√≥n (medicaci√≥n, historial).</li>
            <li>Revisi√≥n de la intenci√≥n y expectativas del paciente.</li>
            <li>Validaci√≥n del protocolo de seguridad y contacto de emergencia.</li>
            <li>Preparaci√≥n del 'Setting': m√∫sica, iluminaci√≥n, confort f√≠sico.</li>
          </ul>
          <h3>Checklist de Navegaci√≥n (En-vuelo)</h3>
          <ul>
            <li>Nivel 1 (Observar): ¬øSignos vitales estables? ¬øRespiraci√≥n regular?</li>
            <li>Nivel 2 (Validar): ¬øEl paciente muestra angustia? (Usar 'Frase de Normalizaci√≥n').</li>
            <li>Nivel 3 (Anclar): ¬øEl paciente est√° en un 'bucle' o p√°nico? (Usar 'Anclaje').</li>
            <li>Nivel 4 (Escalar): ¬øHay riesgo f√≠sico o agitaci√≥n severa? (Revisar 'Banderas Rojas').</li>
          </ul>
        </div>
      `;
    }


    // --- SECCI√ìN 3: FUNCI√ìN PRINCIPAL DE RENDERIZADO (ACTUALIZADA) ---

    function renderizarAtlasCompleto() {
      const container = document.getElementById('atlas-container');
      if (!container || !efectosData || !referenciasData) {
        console.error("Error: Faltan datos (efectos, referencias) o el contenedor HTML.");
        return;
      }
      
      let htmlCompleto = '';

      // 1. Renderizar Portada (ACTUALIZADA CON AUTOR)
      htmlCompleto += `
        <div class="pagina-a4 portada-a4">
          <h1>Atlas Visual de Efectos Psicod√©licos</h1>
          <h2>¬øQu√© puede pasar durante una sesi√≥n?</h2>
          <div class="autor">AUTOR: <strong>Dr. HOPE</strong></div>
        </div>
      `;

      // 2. Renderizar Introducci√≥n
      htmlCompleto += `
        <div class="pagina-a4 introduccion-a4">
          <h1>Introducci√≥n: De la Intuici√≥n al Protocolo</h1>
          ${textoIntroduccion}
        </div>
      `;
      
      // 3. Renderizar Secciones Narrativas
      htmlCompleto += generarSeccion(textoCu√°ndoUsar, "Cu√°ndo usar este atlas");
      htmlCompleto += generarSeccion(textoQu√©Hacer, "Qu√© hacer si lo que ves no encaja");
      htmlCompleto += generarSeccion(textoC√≥moUsar, "C√≥mo usarlo sin crear m√°s confusi√≥n");

      // 4. Renderizar Dominios, Fichas, y P√°gina de Referencias
      for (const dominio of ordenDominios) {
        
        // 4a. P√°gina separadora del Dominio
        htmlCompleto += `
          <div class="pagina-a4 dominio-a4">
            <h1 style="text-transform: capitalize;">Dominio: ${dominio}</h1>
            <p>${textosDominio[dominio]}</p>
          </div>
        `;

        // 4b. Fichas de efectos del dominio
        const efectosDelDominio = efectosData.filter(efecto => efecto.dominio[0] === dominio);
        for (const efecto of efectosDelDominio) {
          htmlCompleto += generarHtmlFicha(efecto);
        }
        
        // 4c. P√°gina √öNICA de Referencias del dominio
        htmlCompleto += generarHtmlReferencias([dominio]);
      }
      
      // 5. Renderizar Ap√©ndices Finales
      htmlCompleto += generarGlosario();
      htmlCompleto += generarChecklist();

      // 6. A√ëADIDO: Renderizar CTA de Cierre
      htmlCompleto += `
        <div class="pagina-a4 cta-a4">
          <div class="cta-contenido">
            <h2>¬øQuieres aprender a aplicar este protocolo en tu pr√°ctica cl√≠nica?</h2>
            <p>Accede al protocolo donde Dr. HOPE explica el modelo completo de intervenci√≥n y supervisi√≥n cl√≠nica con psilocibina.</p>
            <a href="https://app.ecoretreatmountain.com/minicurso-psilocibinclinica" class="cta-boton" target="_blank">Acceder al curso</a>
          </div>
        </div>
      `;

      // 7. Volcar todo el HTML al contenedor
      container.innerHTML = htmlCompleto;
    }

    // Ejecutar el renderizado
    document.addEventListener('DOMContentLoaded', renderizarAtlasCompleto);
  </script>

</body>
</html>